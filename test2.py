from BPSA import *
import math
import shelve

# 取1980~2001年我国铁路营业里程数据为原始数据序列(单位 10^4km)
# 学习样本
samples = [
    # 输入                                 , 输出分量
    (np.mat([5.33, 5.39, 5.29, 5.41, 5.45]), 5.50),
    (np.mat([5.39, 5.29, 5.41, 5.45, 5.50]), 5.57),
    (np.mat([5.29, 5.41, 5.45, 5.50, 5.57]), 5.58),
    (np.mat([5.41, 5.45, 5.50, 5.57, 5.58]), 5.61),
    (np.mat([5.45, 5.50, 5.57, 5.58, 5.61]), 5.69),
    (np.mat([5.50, 5.57, 5.58, 5.61, 5.69]), 5.78),
    (np.mat([5.57, 5.58, 5.61, 5.69, 5.78]), 5.78),
    (np.mat([5.58, 5.61, 5.69, 5.78, 5.78]), 5.81),
    (np.mat([5.61, 5.69, 5.78, 5.78, 5.81]), 5.86),
    (np.mat([5.69, 5.78, 5.78, 5.81, 5.86]), 5.90),
    (np.mat([5.78, 5.78, 5.81, 5.86, 5.90]), 5.97),
    (np.mat([5.78, 5.81, 5.86, 5.90, 5.97]), 6.49),
    (np.mat([5.81, 5.86, 5.90, 5.97, 6.49]), 6.60),
    (np.mat([5.86, 5.90, 5.97, 6.49, 6.60]), 6.64)
]
#测试样本
tests = [
    # 输入                                 , 期待值
    (np.mat([5.90, 5.97, 6.49, 6.60, 6.64]), 6.74),
    (np.mat([5.97, 6.49, 6.60, 6.64, 6.74]), 6.87),
    (np.mat([6.49, 6.60, 6.64, 6.74, 6.87]), 7.01)
]

s = shelve.open('./W_of_7')
W = s['best']

print(MyBP.E(samples, W))

print(W[0])

print(W[1])


for input_p in tests:
    y = MyBP.output_y(input_p[0], W)
    x = MyBP.inverse_sigmoid(y)
    z = (x - input_p[1])*100/input_p[1]
    print(z)
s.close()

print(10**-8)

